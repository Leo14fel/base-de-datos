CREATE DATABASE AUTOMOTRIZ;
USE AUTOMOTRIZ;

SELECT * FROM DEJA
CREATE TABLE DEJA
(
NRORE INTEGER NOT NULL,
IDACCE SMALLINT NOT NULL,
COMENTARIO VARCHAR(40),
PRIMARY KEY (NRORE,IDACCE), 
FOREIGN KEY (NRORE) REFERENCES NOTARECEPCION(NRO)
ON UPDATE CASCADE
ON DELETE CASCADE,
FOREIGN KEY(IDACCE) REFERENCES ACCESORIO(ID)
ON UPDATE CASCADE
ON DELETE CASCADE
);
INSERT INTO DEJA VALUES(100,4,'BUEN ESTADO');
INSERT INTO DEJA VALUES(100,5,'USADO');
INSERT INTO DEJA VALUES(100,7,'2 DELANTEROS');
INSERT INTO DEJA VALUES(100,8,'BUEN ESTADO');
INSERT INTO DEJA VALUES(100,4,'BUEN ESTADO');
INSERT INTO DEJA VALUES(100,5,'USADO');
INSERT INTO DEJA VALUES(100,8,'MAL ESTADO');
INSERT INTO DEJA VALUES(100,4,'BUEN ESTADO');
SELECT * FROM NOTARECEPCION;
/*MOSTRAR TODO LOS ACCESORIOS QUE SE HAN DEJADO EN LA NOTA DE RECEPCION NRO 100*/
SELECT ID,NOMBRE,COMENTARIO
FROM ACCESORIO,DEJA
WHERE ID=IDACCE AND NROE=100;
/*MOSTRAR LA PLACA DE VEHICULOS , DE LOS CUALES SE HA DEJADO LLANTA DE AUXILIO*/
SELECT DISTINCT CI,CLIENTE,NOMBRE
FROM NOTARECEPCION,DEJA ,ACCESORIO
WHERE NRO=NRORE AND IDACCE=ID AND NOMBRE='LLANTA DE AUXILIO'
CREATE TABLE CLIENTE
/*MOSTRAR EL NOMBRE DE LOS CLIENTES QUE HAN DEJADO LLANTA DE AUXILIO*/
SELECT DISTINCT CI,CLIENTE, NOMBRE
FROM NOTARECEPCION,DEJA,ACCESORIO,CLIENTE
WHERE NRO=NRORE AND IDACCE=ID AND CI=CICLIENTE
	AND ACCESORIO,NOMBRE ='LLANTA DE AUXILIO'
    /*MOSTRAR LA CANTIDAD DE ACCESORIOS DEJADOS EN LA NOTA DE RECEPCION NRO 100*/
    SELECT COUNT(*)
    FROM ACCESORIO, DEJA 
    WHERE ID=IDACCCE AND NRORE=100
    /*MOSTRAR LA CANTIDAD DE ACCESORIOS DEJADOS POR CADA NOTA DE RECEPCION*/
    SELECT NRORE,COUNT(IDACCE)
    FROM DEJA
    GROUP BY NRORE 
    
    
    

(
	CI INTEGER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR(60) NOT NULL,
    TELEFONO INTEGER NOT NULL
);

CREATE TABLE VEHICULO
(
	PLACA VARCHAR(7) NOT NULL PRIMARY KEY,
    MARCA VARCHAR(30) NOT NULL,
	MODELO VARCHAR (30) NOT NULL,
    AÑO SMALLINT NOT NULL,
    COLOR VARCHAR(15) NOT NULL
);
CREATE TABLE ACCESORIO
(
	ID SMALLINT NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR (40) NOT NULL
);
CREATE TABLE NOTARECEPCION
(
	NRO INTEGER NOT NULL PRIMARY KEY,
    FECHA DATE NOT NULL,
    HORA TIME NOT NULL,
    KM INTEGER NOT NULL,
    CICLIENTE INTEGER NOT NULL,
    FOREIGN KEY (CICLIENTE) REFERENCES CLIENTE (CI)
    ON UPDATE CASCADE
    ON DELETE CASCADE,      /* CAMBIA LOS DATOS ENTRE DOS CLASES PARA MANTENER LA INTEGRIDAD REFERENCIAL*/
    PLACAVEHICULO VARCHAR(7) NOT NULL,
    FOREIGN KEY (PLACAVEHICULO) REFERENCES VEHICULO (PLACA)
    ON UPDATE CASCADE
    ON DELETE CASCADE
);
/*insertar datos cliente*/
INSERT INTO CLIENTE VALUES(111,'JOAQUIN CHUMACERO',7181234);
INSERT INTO CLIENTE VALUES(222,'SATORNINO MAMANI',6193448);
INSERT INTO CLIENTE VALUES(333,'FABIOLA HERBAS',8273426);
/*INSERTAR DAOTS VEHICULOS*/

INSERT INTO VEHICULO VALUES ('SWKU300','TOYOTA','STARLET',1990,'NEGRO');
INSERT INTO VEHICULO VALUES ('STUP200','TOYOTA','IPSUM',2000,'BLANCO');
INSERT INTO VEHICULO VALUES ('KSH1333','HYUNDAI','F10',2014,'PLOMO');

/*INSERTAR DATOS A NOTA DE RECEPCION*/

INSERT INTO NOTARECEPCION VALUES (100,'2024-8-10','10:00',1000,111,'SWKU300');
INSERT INTO NOTARECEPCION VALUES (101,'2024-8-15','15:00',1500,222,'STUP200');
INSERT INTO NOTARECEPCION VALUES (102,'2024-8-20','12:00',1500,111,'STUP200');
INSERT INTO NOTARECEPCION VALUES (103,'2024-8-15','14:00',1250,333,'KSH1333');

select * from vehiculo;
select * from cliente;
select * from notarecepcion;

/* MOSTRAR KAS NOTAS DE RECEPCION DE JOAQUIN CHUMACERO*/

SELECT NOTARECEPCION.*  /*SOLO * MUESTRA LOS DATOS DEL CLIENTE*/
FROM CLIENTE, NOTARECEPCION
WHERE CI=CICLIENTE AND NOMBRE='JOAQUIN CHUMACERO';

SELECT CI
FROM CLIENTE
WHERE NOMBRE='JOAQUIN CHUMACERO';
/* MOSTRAR EL NOMBRE DE LOS CLIENTES DE TODAS LAS NOTAS DE RECEPCION*/

SELECT *
FROM NOTARECEPCION
WHERE CICLIENTE IN (SELECT CI 
					FROM CLIENTE
                    WHERE NOMBRE='JOAQUIN CHUMACERO');
                    
SELECT NRO, FECHA, HORA, CICLIENTE, NOMBRE
FROM CLIENTE, NOTARECEPCION
WHERE CI=CICLIENTE;


/*MOSTRAR QUE VEHICULO SE DEJO EN LA NOTA DE RECEPCION NRO 100*/
SELECT NRO, PLACA, MARCA, MODELO, AÑO
FROM VEHICULO,NOTARECEPCION
WHERE PLACA=PLACAVEHICULO AND NRO=100;

SELECT *
FROM VEHICULO
WHERE PLACA IN (SELECT PLACAVEHICULO
				FROM NOTARECEPCION
                WHERE NRO=100);

SELECT *
FROM CLIENTE				/*EL DISTINT ES PARA QUE NO SE REPITAN LOS CLIENTES QUE HAYAN SACADO MAS DE UNA NOTA DE RECEPCION*/
WHERE CI IN (SELECT CICLIENTE
			FROM NOTARECEPCION);

/*MOSTRAR LOS VEHICULOS QUE HA DEJADO SATURNINO MAMANI PARA ARREGLO EN EL TALLER*/

SELECT VEHICULO.*
FROM CLIENTE, NOTARECEPCION, VEHICULO 			/*LAS TABLAS QUE SE USARAN*/
WHERE CI=CICLIENTE AND PLACAVEHICULO=PLACA		/*DONDE SE RELACIONAN*/
	AND NOMBRE='SATURNINO MAMANI';				/*LO QUE SE BUSCA*/	
	
/*MOSTAR LOS CLIENTES DE LOS VEHICULOS MARACA TOYOTA*/
SELECT DISTINCT CLIENTE.*  /*PARA QUE NO SE REPITA USAMOS DISTINCT*/
FROM CLIENTE, NOTARECEPCION,VEHICULO
WHERE CI=CICLIENTE AND PLACAVEHICULO=PLACA AND MARCA='TOYOTA'; 

/*MOSTRAR LOS CLIENTES QUE AHN DEJADO SU VEHICULO ENTRE LAS 10:00 Y LAS 12:00*/

SELECT DISTINCT CLIENTE.* /*ESTA PARTE ES LA QUE MUESTRA*/
FROM CLIENTE, NOTARECEPCION
WHERE CI=CICLIENTE AND HORA='10:00' AND HORA='12:00';

SELECT DISTINCT CLIENTE.* /*ESTA PARTE ES LA QUE MUESTRA*/
FROM CLIENTE, NOTARECEPCION
WHERE CI=CICLIENTE AND HORA BETWEEN '10:00' AND '12:00';

SELECT *
FROM CLIENTE
WHERE CI IN (SELECT CICLIENTE
			FROM NOTARECEPCION
            WHERE HORA>='10:00' AND HORA<='12:00');
/*MOSTRAR LA CANTIDAD DE VEHICULOS DE LA MARCA TOYOTA*/ /*HACER PARA LA PROX CLASE */

SELECT COUNT(*)
FROM VEHICULO
WHERE MARCA='TOYOTA';

/*MOSTRAR CUANTAS VECES A DEJADO JOAQUIN CHUMACERO SU VEHICULO SWKU300*/

SELECT *
FROM CLIENTE, NOTARECEPCION
WHERE CI=CLIENTE AND PLACAVEHICULOO='SWKU300' AND NOMBRE='JOAQUIN CHUMACERO';  /*DA ERROR NO SE CUAL ES EL PROBLEMA BRAHIAN ARREGLALO PORFA*/

/*MOSTRAR LA CATIDAD DE NOTAS DE RECEPCION DE JOAQUIN CHUMACERO*/

SELECT COUNT(*)
FROM CLIENTE, NOTARECEPCION
WHERE CI=CICLIENTE AND NOMBRE='JOAQUIN CHUMACERO';

SELECT CI, NOMBRE,COUNT(NRO) AS CANTIDAD     /*  */
FROM CLIENTE,NOTARECEPCION
WHERE CI=CICLIENTE
GROUP BY CI
ORDER BY CANTIDAD DESC;
