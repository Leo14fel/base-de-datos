CREATE DATABASE BIBLIOTECA;
USE BIBLIOTECA;
DROP DATABASE BIBLIOTECA
CREATE TABLE TIPOUSUARIO;
(
ID tinyint NOT NULL PRIMARY KEY,
NOMBRE VARCHAR(60) NOT NULL
);

CREATE TABLE USUARIO (
CI INTEGER NOT NULL PRIMARY KEY,
NOMBRE VARCHAR(60) NOT NULL, 
DIRECCION VARCHAR(60) NOT NULL,
TELEFONO INTEGER NOT NULL,
IDTIPO tinyint NOT NULL,
FOREIGN KEY (IDTIPO) REFERENCES TIPOUSUARIO(ID)
ON UPDATE CASCADE
ON DELETE CASCADE
);
CREATE TABLE MATERIAL_BIBLIOGRAFICO(
CODMAT INTEGER NOT NULL PRIMARY KEY,
TITULO VARCHAR(50) NOT NULL,
NROPAG smallint NOT NULL,
EDITORIAL VARCHAR(50) NOT NULL,
TIPO CHAR NOT NULL
);

CREATE TABLE LIBRO(
CODMAT INTEGER NOT NULL PRIMARY KEY,
EDICION varchar(15) NOT NULL,
AÑOP smallint NOT NULL,
FOREIGN KEY (CODMAT) REFERENCES MATERIAL_BIBLIOGRAFICO(CODMAT)
ON UPDATE CASCADE
ON DELETE CASCADE
);

drop table libro

CREATE TABLE REVISTA(
CODMAT INTEGER NOT NULL PRIMARY KEY,
NRO tinyint NOT NULL,
AÑOP smallint NOT NULL,
FOREIGN KEY (CODMAT) REFERENCES MATERIAL_BIBLIOGRAFICO(CODMAT)
ON UPDATE CASCADE
ON DELETE CASCADE
);

CREATE TABLE PERIODICO(
CODMAT INTEGER NOT NULL PRIMARY KEY,
FECHA DATE NOT NULL,
FOREIGN KEY (CODMAT) REFERENCES MATERIAL_BIBLIOGRAFICO(CODMAT)
ON UPDATE CASCADE
ON DELETE CASCADE
);

CREATE TABLE FICHAPRESTAMO(
NROFICHA INTEGER NOT NULL PRIMARY KEY,
FECHA DATE NOT NULL,
HORA TIME NOT NULL,
FECHADEV DATE NOT NULL,
CODMAT INTEGER NOT NULL,
CI INTEGER NOT NULL,
FOREIGN KEY (CODMAT) REFERENCES MATERIAL_BIBLIOGRAFICO(CODMAT)
  ON UPDATE CASCADE
  ON DELETE CASCADE,
FOREIGN KEY (CI) REFERENCES USUARIO(CI)
  ON UPDATE CASCADE
  ON DELETE CASCADE
);

/*DATOS INSERTADOS EN LA TABLA*/

INSERT INTO FICHAPRESTAMO VALUES(100, 2024-08-10, '10:00:00', 2024-08-12, 100, 222);
INSERT INTO FICHAPRESTAMO VALUES(101, 2024-08-15, '12:00:00', 2024-08-17, 100, 111);
INSERT INTO FICHAPRESTAMO VALUES(102, 2024-08-15, '15:00:00', 2024-08-17, 101, 222);
INSERT INTO FICHAPRESTAMO VALUES(103, 2024-08-20, '9:00:00', 2024-08-22, 102, 333);

INSERT INTO USUARIO VALUES(111, 'JOAQUIN CHUMACERO', 'URB. LOS CHUMAS 200', 7102030, 2);
INSERT INTO USUARIO VALUES(222, 'SATURNINO MAMANI', 'CALLE JUNION 300', 7234559, 1);
INSERT INTO USUARIO VALUES(333, 'FABIOLA MENDEZ', 'CALLE LANDIVAR 123', 72311111, 1);

INSERT INTO TIPOUSUARIO VALUES(1, 'ESTUDIANTE');
INSERT INTO TIPOUSUARIO VALUES(2, 'DOCENTE');

INSERT INTO MATERIAL_BIBLIOGRAFICO VALUES(100, 'BASES DE DATOS PRINCIPIANTES', 120, 'LA HOGUERA', 'L');
INSERT INTO MATERIAL_BIBLIOGRAFICO VALUES(101, 'MAGAZINE', 50, 'LA PRINCIPAL', 'R');
INSERT INTO MATERIAL_BIBLIOGRAFICO VALUES(102, 'EL DEBER', 40, 'GENERAL', 'P');
INSERT INTO MATERIAL_BIBLIOGRAFICO VALUES(103, 'APUNTES DE ALGORITMO', 100, 'LA HOGUERA', 'L');
INSERT INTO MATERIAL_BIBLIOGRAFICO VALUES(104, 'PROGRAMACION SIMPLE', 80, 'GENERAL', 'R');

INSERT INTO LIBRO VALUES(100, '1ERA EDICION', 2005);
INSERT INTO LIBRO VALUES(103, '2DA EDICION', 2020);

INSERT INTO REVISTA VALUES(101, 1, 2018);
INSERT INTO REVISTA VALUES(104, 1, 2020);

INSERT INTO PERIODICO VALUES(102, 2024-08-11);


/MOSTRAR TODAS AQUELLAS REVISTAS QUE NO HAN SIDO PRESTADOS/
SELECT USUARIO.CI,NOMBRE,COUNT(*)
FROM USUARIO,FICHAPRESTAMO
WHERE USUARIO.CI=FICHAPRESTAMO.CI
HAVING COUNT(*)>=2

/MOSTRAR  EL MATERIAL BIBLIOGRAFICO DE MAS DE 50 PAG/


/MOSTRAR LA CANTIDAD DE FICHAS DE PRESTAMOS REALIZADO POR CADA USUARIO/


/MOSTRAR LOS USUARIOS DOCENTES QUE HAN SACADO LIBROS/